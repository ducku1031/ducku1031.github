---
layout: post
title: "Ansible"
description: "Ansible"
categories: [Linux]
tags: [Devops, Ansible]
redirect_from:
  - /2020/08/21/
---

* Kramdown table of contents
{:toc .toc}


# Ansible

![w1](https://user-images.githubusercontent.com/69279022/90725238-d450fc00-e2fa-11ea-8d4d-c504b7ecce42.png)

- Ansible Core 

> 동작에 필요한 최소한의 Package   

- Ansible Tower

> - 편의성 증가   
> - GUI 지원   
> - 스케줄링 및 가시성 증가   

<br>

# Ansible 관련 파일

## /etc/ansible/ansible.cfg
> Ansible 환경 설정 파일   

## /etc/ansible/hosts
> Ansible이 접속하는 호스트들에 대한 정보   

# Ansible 옵션


## -i(--inventory-file)

> Host 정보를 가지고 있는 파일을 사용자가 별도로 정의하여 사용하기 위한 옵션
~~~
[kbd031@server ~]$ vi test
192.168.100.5
192.168.100.6
~~~
~~~
[kbd031@server ~]$ ansible all -m ping -i test
192.168.100.5 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
    "changed": false, 
    "ping": "pong"
}
192.168.100.6 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
    "changed": false, 
    "ping": "pong"
}
~~~
- 기본으로 /etc/ansible/hosts 파일에 등록된 정보를 사용한다.   
- 별도로 Inventory 파일을 생성하여 기본파일이 아닌 내가 생성한 파일의 정보를 사용한다.   

## -m(--module-name)

> Ansible 에서 Modu

## -k(--ask-pass)

> Ansible 명령어 사용시 Password를 질의하도록 하는 옵션
~~~
[kbd031@server ~]$ ansible all -m ping -k
~~~

## -K(--ask-become-pass)

> 관리자로 권한 상승을 위한 옵션

## - --list-hosts

> Host List를 출력하여 확인하는데 사용하는 옵션
~~~
[kbd031@server ~]$ ansible all --list-host
  hosts (3):
    192.168.100.5
    192.168.100.6
    192.168.100.7
~~~
~~~
[kbd031@server ~]$ ansible web --list-host
  hosts (3):
    192.168.100.5
    192.168.100.6
    192.168.100.7
~~~
- **all** 을 사용하여 모든 Host List를 출력
- **web** 을 사용하여 선택한 Group의 Host List만 출력

# Ansible Core 설치

![z1](https://user-images.githubusercontent.com/69279022/90864781-47767300-e3cc-11ea-98de-fdc071741e85.png)

<br>

` EPEL Repository Install `
~~~
[kbd031@server ~]$ sudo yum install epel-release
~~~
- Ansible Package를 설치하기 위해서는 사전에 EPEL-RPRO를 설치해야 한다.  

<br>

` Ansible Package Install `
~~~cpp
[kbd031@server ~]$ sudo yum install ansible
~~~

<br>

` Ansible TEST `
~~~
[user@server ~]$ ansible all -m ping
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'
~~~
- Hosts List가 비어있어 정상적으로 되지 않는다고 나온다.

<br>

` /etc/ansible/hosts `
~~~
[kbd031@server ~]$ sudo vi /etc/ansible/hosts
[web]
192.168.100.5
192.168.100.6
192.168.100.7
~~~
- 아무곳에 추가로 작성한다.
- **[web]** 은 입력한 IP 들의 Group Name을 뜻한다.
<br>

` Ansible TEST `
~~~
[kbd031@server ~]$ ansible --list-hosts all
  hosts (3):
    192.168.100.5
    192.168.100.6
    192.168.100.7
~~~
` 등록한 모든 Host 확인 `
~~~
[kbd031@server ~]$ ansible all -m ping
192.168.100.6 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}
192.168.100.5 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}
192.168.100.7 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}
~~~
- 모든 Host에 Ping 명령어가 성공하였다
- 처음 ssh로 접속하는 경우 Public Key 교환으로 인한 질의를 할 수 도 있는데 yes를 입력 후 다시해보자.

<br>